# 🚀 PARTSCONTROL 小白部署指南

## 📋 部署前准备

### 1. 服务器要求
- **操作系统**: Ubuntu 20.04 或更高版本
- **内存**: 至少 2GB RAM
- **存储**: 至少 10GB 可用空间
- **网络**: 有公网IP地址

### 2. 需要准备的信息
- 服务器IP地址
- 服务器登录密码
- 一个域名（可选，但推荐）

## 🎯 第一步：连接服务器

### 1.1 使用SSH连接服务器
```bash
# 在您的电脑上打开终端或命令提示符，输入：
ssh root@您的服务器IP地址

# 例如：
ssh root@123.456.789.123
```

### 1.2 输入密码
连接后会提示输入密码，输入您的服务器密码（输入时不会显示字符）

## 🔧 第二步：安装基础软件

### 2.1 更新系统
```bash
# 复制粘贴以下命令：
sudo apt update && sudo apt upgrade -y
```

### 2.2 安装Node.js
```bash
# 复制粘贴以下命令：
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

### 2.3 安装MySQL
```bash
# 复制粘贴以下命令：
sudo apt install mysql-server -y
sudo systemctl start mysql
sudo systemctl enable mysql
```

### 2.4 安装Nginx
```bash
# 复制粘贴以下命令：
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 2.5 安装PM2
```bash
# 复制粘贴以下命令：
sudo npm install -g pm2
```

## 📁 第三步：上传项目文件

### 方法1：使用Git（推荐）
```bash
# 创建项目目录
sudo mkdir -p /var/www/partcontrol
sudo chown $USER:$USER /var/www/partcontrol
cd /var/www/partcontrol

# 如果您有Git仓库，使用：
git clone https://github.com/您的用户名/PARTSCONTROL.git .
```

### 方法2：使用文件上传工具
1. 在您的电脑上下载并安装 **FileZilla** 或 **WinSCP**
2. 使用这些工具将项目文件夹上传到服务器的 `/var/www/partcontrol/` 目录

## ⚙️ 第四步：配置数据库

```bash
# 复制粘贴以下命令：
sudo mysql -e "CREATE DATABASE IF NOT EXISTS partcontrol CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
sudo mysql -e "CREATE USER IF NOT EXISTS 'partcontrol'@'localhost' IDENTIFIED BY 'PartControl2024!';"
sudo mysql -e "GRANT ALL PRIVILEGES ON partcontrol.* TO 'partcontrol'@'localhost';"
sudo mysql -e "FLUSH PRIVILEGES;"
```

## 🔧 第五步：配置项目

### 5.1 进入项目目录
```bash
cd /var/www/partcontrol
```

### 5.2 配置环境变量
```bash
# 复制环境变量模板
cp env.example .env
```

### 5.3 安装后端依赖
```bash
cd 后端
npm install
mkdir -p uploads logs
chmod 755 uploads logs
```

### 5.4 安装前端依赖
```bash
cd ../前端
npm install
npm run build
```

## 🌐 第六步：配置Nginx

### 6.1 创建Nginx配置
```bash
# 复制粘贴以下命令：
sudo tee /etc/nginx/sites-available/partcontrol > /dev/null << 'EOF'
server {
    listen 80;
    server_name _;
    
    location / {
        root /var/www/partcontrol/前端/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }
    
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    location /uploads {
        alias /var/www/partcontrol/后端/uploads;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
EOF
```

### 6.2 启用配置
```bash
# 复制粘贴以下命令：
sudo ln -sf /etc/nginx/sites-available/partcontrol /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl restart nginx
```

## 🚀 第七步：启动服务

```bash
# 复制粘贴以下命令：
cd /var/www/partcontrol/后端
pm2 start server.js --name "partcontrol-backend"
pm2 save
pm2 startup
```

## ✅ 第八步：验证部署

### 8.1 检查服务状态
```bash
# 检查后端服务
pm2 status

# 检查Nginx服务
sudo systemctl status nginx

# 检查MySQL服务
sudo systemctl status mysql
```

### 8.2 访问应用
在浏览器中输入：`http://您的服务器IP地址`

## 🔧 常见问题解决

### 问题1：端口被占用
```bash
# 查看端口占用
sudo netstat -tlnp | grep :3000

# 杀死进程（替换<PID>为实际的进程ID）
sudo kill -9 <PID>
```

### 问题2：权限问题
```bash
# 修复文件权限
sudo chown -R www-data:www-data /var/www/partcontrol
sudo chmod -R 755 /var/www/partcontrol
```

### 问题3：数据库连接失败
```bash
# 检查MySQL状态
sudo systemctl status mysql

# 重启MySQL
sudo systemctl restart mysql
```

### 问题4：Nginx配置错误
```bash
# 检查Nginx配置
sudo nginx -t

# 查看Nginx错误日志
sudo tail -f /var/log/nginx/error.log
```

## 📊 部署信息

### 重要信息
- **项目路径**: `/var/www/partcontrol`
- **数据库名**: `partcontrol`
- **数据库用户**: `partcontrol`
- **数据库密码**: `PartControl2024!`
- **后端端口**: `3000`
- **前端端口**: `80`

### 管理命令
```bash
# 查看服务状态
pm2 status

# 查看服务日志
pm2 logs

# 重启服务
pm2 restart partcontrol-backend

# 停止服务
pm2 stop partcontrol-backend

# 启动服务
pm2 start partcontrol-backend
```

## 🔒 安全建议

1. **修改默认密码**
   - 数据库密码
   - 服务器登录密码

2. **配置防火墙**
   ```bash
   sudo apt install ufw -y
   sudo ufw allow ssh
   sudo ufw allow 80
   sudo ufw allow 443
   sudo ufw enable
   ```

3. **申请SSL证书**（如果有域名）
   ```bash
   sudo apt install certbot python3-certbot-nginx -y
   sudo certbot --nginx -d 您的域名.com
   ```

## 📞 技术支持

如果遇到问题：
1. 检查错误日志：`pm2 logs`
2. 检查Nginx日志：`sudo tail -f /var/log/nginx/error.log`
3. 检查系统日志：`sudo journalctl -u nginx`

---

**部署完成时间**: 通常需要20-30分钟  
**建议**: 首次部署建议在测试环境进行 